<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple Branching Process model • spread</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simple Branching Process model">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spread</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2020.3.19</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/commuter_model.html">Commuter Model Intro</a>
    </li>
    <li>
      <a href="../articles/including_vax.html">Commuter Model With Vax Data</a>
    </li>
    <li>
      <a href="../articles/asymmetric_mobility_intro.html">Asymmetric Mobility Intro</a>
    </li>
    <li>
      <a href="../articles/branching_process.html">Simple Branching Process Model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/">Reference</a>
</li>
<li>
  <a href="../news/">Changelog</a>
</li>
<li>
  <a href="../CONTRIBUTING.html">Contributing</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/folkehelseinstituttet/spread/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Simple Branching Process model</h1>
                        <h4 class="author">Gunnar Rø</h4>
            
            <h4 class="date">2020-01-31</h4>
      
      
      <div class="hidden name"><code>branching_process.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>We show how to use the branching process model by modelling the potential spread of SARS-like corona virus. The branching process model takes information about the basic reproduction number, the serial interval and a dispersion parameter and can make short term forecasts of the number of new cases. The current model does not take into account depletion of suceptibles or the introduction of any control measures.</p>
<p>Following <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2760158">Lipsitch et Al 2003</a> we use a value for R0 of 3 and a serial interval with mean 8.4 days and SD 3.4 days. We also set the dispersion parameter to 0.16 following <a href="https://www.nature.com/articles/nature04153">Lloyd-Smith et Al 2005</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(epitrix)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#Defining the serial interval</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">mu &lt;-<span class="st"> </span><span class="fl">8.4</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">sd &lt;-<span class="st"> </span><span class="fl">3.4</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">param &lt;-<span class="st"> </span>epitrix<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/epitrix/man/gamma_tools.html">gamma_mucv2shapescale</a></span>(mu, sd<span class="op">/</span>mu)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">si &lt;-<span class="st">   </span>distcrete<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/distcrete/man/distcrete.html">distcrete</a></span>(<span class="st">"gamma"</span>, <span class="dt">interval =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">                <span class="dt">shape =</span> param<span class="op">$</span>shape,</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">                <span class="dt">scale =</span> param<span class="op">$</span>scale, <span class="dt">w =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">incidences &lt;-<span class="st"> </span>spread<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/spread/man/branching_process.html">branching_process</a></span>(<span class="dt">initial_cases=</span><span class="dv">1</span>,                </a>
<a class="sourceLine" id="cb1-15" data-line-number="15">                         <span class="dt">R0=</span><span class="fl">1.4</span>,</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">                         <span class="dt">dispersion=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">                         <span class="dt">serial_interval=</span>si,</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">                         <span class="dt">days_simulation=</span><span class="dv">30</span>,</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">                         <span class="dt">simulations=</span><span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">summary &lt;-<span class="st"> </span>spread<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/spread/man/summarize_bp.html">summarize_bp</a></span>(incidences)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">spread<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/spread/man/plot_quantiles_bp.html">plot_quantiles_bp</a></span>(incidences) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Estimated daily incidence"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Days"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Incidence"</span>)</a></code></pre></div>
<p><img src="branching_process_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">spread<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/spread/man/plot_quantiles_bp.html">plot_quantiles_bp</a></span>(summary<span class="op">$</span>cumulative) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Estimated cumulative case counts"</span>)  <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Days"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"cumulative Cases"</span>)</a></code></pre></div>
<p><img src="branching_process_files/figure-html/unnamed-chunk-1-2.png" width="672"></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x=</span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(incidences))) <span class="op">+</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() <span class="op">+</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Distribution of number of cases after 30 days"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"N cases after 30 days"</span>) </a></code></pre></div>
<p><img src="branching_process_files/figure-html/unnamed-chunk-1-3.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(summary<span class="op">$</span>cumulative[<span class="dv">30</span>,]))</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; [1] 5</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(summary<span class="op">$</span>p_no_spread)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; [1] 0.274</span></a></code></pre></div>
<p>The median number of cases is around 50, with a probability of no spread is around 6%.</p>
</div>
<div id="estimating-parameters-via-approximate-bayesian-computation-abc" class="section level1">
<h1 class="hasAnchor">
<a href="#estimating-parameters-via-approximate-bayesian-computation-abc" class="anchor"></a>Estimating parameters via approximate Bayesian computation (ABC)</h1>
<p>We can also estimate the R0 if we know the number of cases after a time t. Here we will assume that there are between 2000 and 4000 cases after 56 days. One can also here vary the other parameters to include uncertainty in them</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">mu &lt;-<span class="st"> </span><span class="fl">8.4</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">sd &lt;-<span class="st"> </span><span class="fl">3.4</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">param &lt;-<span class="st"> </span>epitrix<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/epitrix/man/gamma_tools.html">gamma_mucv2shapescale</a></span>(mu, sd<span class="op">/</span>mu)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">si &lt;-<span class="st">   </span>distcrete<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/distcrete/man/distcrete.html">distcrete</a></span>(<span class="st">"gamma"</span>, <span class="dt">interval =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">                <span class="dt">shape =</span> param<span class="op">$</span>shape,</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">                <span class="dt">scale =</span> param<span class="op">$</span>scale, <span class="dt">w =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">params &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="cf">for</span>(R0 <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dt">from=</span><span class="dv">1</span>, <span class="dt">to=</span><span class="dv">10</span>, <span class="dt">by=</span><span class="fl">0.05</span>)){</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">    params[[<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(params)<span class="op">+</span><span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">      <span class="dt">initial_cases=</span><span class="dv">1</span>,                </a>
<a class="sourceLine" id="cb5-11" data-line-number="11">      <span class="dt">R0=</span>R0,</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">      <span class="dt">dispersion=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">      <span class="dt">serial_interval=</span>si,</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">      <span class="dt">days_simulation=</span><span class="dv">56</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15">    )</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">}</a>
<a class="sourceLine" id="cb5-17" data-line-number="17"></a>
<a class="sourceLine" id="cb5-18" data-line-number="18">r &lt;-<span class="st"> </span>spread<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/spread/man/fit_params_bp.html">fit_params_bp</a></span>(</a>
<a class="sourceLine" id="cb5-19" data-line-number="19">  <span class="dt">cases_min =</span> <span class="dv">2000</span>,</a>
<a class="sourceLine" id="cb5-20" data-line-number="20">  <span class="dt">cases_max =</span> <span class="dv">3000</span>, </a>
<a class="sourceLine" id="cb5-21" data-line-number="21">  <span class="dt">param_list =</span> params, </a>
<a class="sourceLine" id="cb5-22" data-line-number="22">  <span class="dt">simulations=</span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23">  )</a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(HDInterval<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html">hdi</a></span>(r<span class="op">$</span>R0))</a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="co">#&gt; lower upper </span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="co">#&gt;  2.05  4.35 </span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="co">#&gt; attr(,"credMass")</span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="co">#&gt; [1] 0.95</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#background">Background</a></li>
      <li><a href="#estimating-parameters-via-approximate-bayesian-computation-abc">Estimating parameters via approximate Bayesian computation (ABC)</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Solveig Engebretsen, Andreas Nygård Osnes, Gunnar Rø Osnes, Richard White.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
