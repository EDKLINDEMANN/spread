<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Commuter Model â€¢ spread</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Commuter Model">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spread</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2019.5.19</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/commuter_model.html">Commuter Model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/">Reference</a>
</li>
<li>
  <a href="../news/">Changelog</a>
</li>
<li>
  <a href="../CONTRIBUTING.html">Contributing</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/folkehelseinstituttet/spread/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Commuter Model</h1>
                        <h4 class="author">Richard White</h4>
            
            <h4 class="date">2019-05-19</h4>
      
      
      <div class="hidden name"><code>commuter_model.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>This model is a stochastic SEIIaR (susceptible, exposed, infectious, infectious asymptomatic, recovered) metapopulation model. Each location has a local infection system, while the locations are connected by people who commute each day. The model differentiates between day and night. During the day you can infect/be infected in the location where you work, while during the night you can infect/be infected in the location where you live. It is the same commuters who travel back and forth each day. At the start of a day, all commuters are sent to their work location, where they mix for 12 hours. The commuters are then sent to their respective home locations, where they mix for 12 hours. The model is based upon a published model.</p>
</div>
<div id="example" class="section level1">
<h1 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(data.table)</a></code></pre></div>
<p>We simulate:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">d &lt;-<span class="st"> </span>spread<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/spread/topics/commuter">commuter</a></span>(</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="dt">seiiar=</span>spread<span class="op">::</span>norway_seiiar_oslo_<span class="dv">2017</span>,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="dt">commuters=</span>spread<span class="op">::</span>norway_commuters_<span class="dv">2017</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="dt">r0=</span><span class="fl">1.6</span>,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="dt">latent_period =</span> <span class="fl">1.9</span>,</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="dt">infectious_period =</span> <span class="fl">3.0</span>,</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  <span class="dt">asymptomatic_prob=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  <span class="dt">asymptomatic_relative_infectiousness=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  <span class="dt">N=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  <span class="dt">M=</span><span class="dv">7</span><span class="op">*</span><span class="dv">9</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; Starting to add edges, printing every 1000 edge</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; 1000 2000 3000 4000 5000 6000 7000 8000 9000 10000 11000 12000 13000 14000 15000 16000 17000 18000 19000 20000 21000 22000 23000 24000 25000 26000 27000 28000 Found 28923 edges</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; Running 1 simulations of 63 days</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; Finished all simulations</span></a></code></pre></div>
<p>Inspecting the data from Oslo:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">d[location_code<span class="op">==</span><span class="st">"municip0301"</span>]</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt;     location_code week day is_6pm      S   E   I Ia    R incidence    pop</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;  1:   municip0301    1   1   TRUE 666751   1   6  0    4         0 666762</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;  2:   municip0301    1   2   TRUE 666749   3   2  0    8         0 666762</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt;  3:   municip0301    1   3   TRUE 666748   1   3  0   10         3 666762</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;  4:   municip0301    1   4   TRUE 666747   1   3  0   11         1 666762</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;  5:   municip0301    1   5   TRUE 666744   2   3  0   13         1 666762</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt;  6:   municip0301    1   6   TRUE 666742   3   2  0   15         1 666762</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;  7:   municip0301    1   7   TRUE 666741   3   1  0   17         1 666762</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt;  8:   municip0301    2   8   TRUE 666741   1   2  0   18         2 666762</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt;  9:   municip0301    2   9   TRUE 666739   3   2  0   18         0 666762</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; 10:   municip0301    2  10   TRUE 666736   4   4  0   18         2 666762</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; 11:   municip0301    2  11   TRUE 666730   9   3  0   20         1 666762</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt; 12:   municip0301    2  12   TRUE 666729   4   8  0   21         6 666762</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt; 13:   municip0301    2  13   TRUE 666728   4   5  0   25         1 666762</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt; 14:   municip0301    2  14   TRUE 666724   5   8  0   25         2 666762</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt; 15:   municip0301    3  15   TRUE 666723   3   9  0   27         3 666762</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt; 16:   municip0301    3  16   TRUE 666719   5   9  0   29         3 666762</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">#&gt; 17:   municip0301    3  17   TRUE 666716   5   7  0   34         2 666762</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co">#&gt; 18:   municip0301    3  18   TRUE 666713   4   8  0   37         1 666762</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="co">#&gt; 19:   municip0301    3  19   TRUE 666704  12   7  0   39         1 666762</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="co">#&gt; 20:   municip0301    3  20   TRUE 666702   9  11  0   40         5 666762</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="co">#&gt; 21:   municip0301    3  21   TRUE 666691  12  17  0   42         7 666762</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="co">#&gt; 22:   municip0301    4  22   TRUE 666689   8  17  0   48         5 666762</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="co">#&gt; 23:   municip0301    4  23   TRUE 666685   9  15  0   53         4 666762</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26"><span class="co">#&gt; 24:   municip0301    4  24   TRUE 666674  16  15  0   57         5 666762</span></a>
<a class="sourceLine" id="cb3-27" data-line-number="27"><span class="co">#&gt; 25:   municip0301    4  25   TRUE 666670  16  11  0   65         3 666762</span></a>
<a class="sourceLine" id="cb3-28" data-line-number="28"><span class="co">#&gt; 26:   municip0301    4  26   TRUE 666665  15  14  0   68         8 666762</span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29"><span class="co">#&gt; 27:   municip0301    4  27   TRUE 666660  11  19  0   72         9 666762</span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30"><span class="co">#&gt; 28:   municip0301    4  28   TRUE 666648  15  23  0   76         9 666762</span></a>
<a class="sourceLine" id="cb3-31" data-line-number="31"><span class="co">#&gt; 29:   municip0301    5  29   TRUE 666636  18  27  0   81        10 666762</span></a>
<a class="sourceLine" id="cb3-32" data-line-number="32"><span class="co">#&gt; 30:   municip0301    5  30   TRUE 666620  25  30  0   87         9 666762</span></a>
<a class="sourceLine" id="cb3-33" data-line-number="33"><span class="co">#&gt; 31:   municip0301    5  31   TRUE 666609  22  34  0   97        12 666762</span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34"><span class="co">#&gt; 32:   municip0301    5  32   TRUE 666593  25  36  0  108        14 666762</span></a>
<a class="sourceLine" id="cb3-35" data-line-number="35"><span class="co">#&gt; 33:   municip0301    5  33   TRUE 666578  29  28  0  127         8 666762</span></a>
<a class="sourceLine" id="cb3-36" data-line-number="36"><span class="co">#&gt; 34:   municip0301    5  34   TRUE 666569  26  25  0  142        10 666762</span></a>
<a class="sourceLine" id="cb3-37" data-line-number="37"><span class="co">#&gt; 35:   municip0301    5  35   TRUE 666558  27  24  0  153        10 666762</span></a>
<a class="sourceLine" id="cb3-38" data-line-number="38"><span class="co">#&gt; 36:   municip0301    6  36   TRUE 666539  29  32  0  162        16 666762</span></a>
<a class="sourceLine" id="cb3-39" data-line-number="39"><span class="co">#&gt; 37:   municip0301    6  37   TRUE 666534  18  33  0  177        15 666762</span></a>
<a class="sourceLine" id="cb3-40" data-line-number="40"><span class="co">#&gt; 38:   municip0301    6  38   TRUE 666517  22  36  0  187        13 666762</span></a>
<a class="sourceLine" id="cb3-41" data-line-number="41"><span class="co">#&gt; 39:   municip0301    6  39   TRUE 666499  31  38  0  194         8 666762</span></a>
<a class="sourceLine" id="cb3-42" data-line-number="42"><span class="co">#&gt; 40:   municip0301    6  40   TRUE 666480  28  45  0  209        22 666762</span></a>
<a class="sourceLine" id="cb3-43" data-line-number="43"><span class="co">#&gt; 41:   municip0301    6  41   TRUE 666464  29  42  0  227        18 666762</span></a>
<a class="sourceLine" id="cb3-44" data-line-number="44"><span class="co">#&gt; 42:   municip0301    6  42   TRUE 666435  44  37  0  246        12 666762</span></a>
<a class="sourceLine" id="cb3-45" data-line-number="45"><span class="co">#&gt; 43:   municip0301    7  43   TRUE 666414  46  44  0  258        20 666762</span></a>
<a class="sourceLine" id="cb3-46" data-line-number="46"><span class="co">#&gt; 44:   municip0301    7  44   TRUE 666382  53  56  0  271        23 666762</span></a>
<a class="sourceLine" id="cb3-47" data-line-number="47"><span class="co">#&gt; 45:   municip0301    7  45   TRUE 666361  43  71  0  287        28 666762</span></a>
<a class="sourceLine" id="cb3-48" data-line-number="48"><span class="co">#&gt; 46:   municip0301    7  46   TRUE 666321  60  71  0  310        24 666762</span></a>
<a class="sourceLine" id="cb3-49" data-line-number="49"><span class="co">#&gt; 47:   municip0301    7  47   TRUE 666294  54  84  0  330        32 666762</span></a>
<a class="sourceLine" id="cb3-50" data-line-number="50"><span class="co">#&gt; 48:   municip0301    7  48   TRUE 666249  72  85  0  356        28 666762</span></a>
<a class="sourceLine" id="cb3-51" data-line-number="51"><span class="co">#&gt; 49:   municip0301    7  49   TRUE 666197  84  96  0  385        37 666762</span></a>
<a class="sourceLine" id="cb3-52" data-line-number="52"><span class="co">#&gt; 50:   municip0301    8  50   TRUE 666151  88 111  0  412        43 666762</span></a>
<a class="sourceLine" id="cb3-53" data-line-number="53"><span class="co">#&gt; 51:   municip0301    8  51   TRUE 666094  99 116  0  453        45 666762</span></a>
<a class="sourceLine" id="cb3-54" data-line-number="54"><span class="co">#&gt; 52:   municip0301    8  52   TRUE 666037 108 131  0  486        46 666762</span></a>
<a class="sourceLine" id="cb3-55" data-line-number="55"><span class="co">#&gt; 53:   municip0301    8  53   TRUE 665958 128 144  0  532        55 666762</span></a>
<a class="sourceLine" id="cb3-56" data-line-number="56"><span class="co">#&gt; 54:   municip0301    8  54   TRUE 665887 126 163  0  586        71 666762</span></a>
<a class="sourceLine" id="cb3-57" data-line-number="57"><span class="co">#&gt; 55:   municip0301    8  55   TRUE 665806 134 174  0  648        67 666762</span></a>
<a class="sourceLine" id="cb3-58" data-line-number="58"><span class="co">#&gt; 56:   municip0301    8  56   TRUE 665706 161 180  0  715        71 666762</span></a>
<a class="sourceLine" id="cb3-59" data-line-number="59"><span class="co">#&gt; 57:   municip0301    9  57   TRUE 665613 157 222  0  770        91 666762</span></a>
<a class="sourceLine" id="cb3-60" data-line-number="60"><span class="co">#&gt; 58:   municip0301    9  58   TRUE 665512 170 231  0  849        75 666762</span></a>
<a class="sourceLine" id="cb3-61" data-line-number="61"><span class="co">#&gt; 59:   municip0301    9  59   TRUE 665393 183 260  0  926       104 666762</span></a>
<a class="sourceLine" id="cb3-62" data-line-number="62"><span class="co">#&gt; 60:   municip0301    9  60   TRUE 665254 225 263  0 1020        92 666762</span></a>
<a class="sourceLine" id="cb3-63" data-line-number="63"><span class="co">#&gt; 61:   municip0301    9  61   TRUE 665136 239 281  0 1106       103 666762</span></a>
<a class="sourceLine" id="cb3-64" data-line-number="64"><span class="co">#&gt; 62:   municip0301    9  62   TRUE 664982 268 310  0 1202       114 666762</span></a>
<a class="sourceLine" id="cb3-65" data-line-number="65"><span class="co">#&gt; 63:   municip0301    9  63   TRUE 664799 307 341  0 1315       134 666762</span></a>
<a class="sourceLine" id="cb3-66" data-line-number="66"><span class="co">#&gt;     location_code week day is_6pm      S   E   I Ia    R incidence    pop</span></a></code></pre></div>
<p>We can merge in information about counties, and create county level data:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">d &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/merge">merge</a></span>(d,fhidata<span class="op">::</span>norway_locations_current, <span class="dt">by.x=</span><span class="st">"location_code"</span>,<span class="dt">by.y=</span><span class="st">"municip_code"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">county &lt;-<span class="st"> </span>d[,.(</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="dt">S=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(S),</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="dt">E=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(E),</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="dt">I=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(I),</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  <span class="dt">Ia=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(Ia),</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  <span class="dt">R=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(R),</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  <span class="dt">incidence=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(incidence),</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">  <span class="dt">pop=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(pop)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">),</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">keyby=.(county_code,county_name,week,day,is_6pm)]</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">county[,county_name<span class="op">:</span><span class="er">=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(county_name,<span class="dt">levels=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/duplicated">unique</a></span>(fhidata<span class="op">::</span>norway_locations_current[,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"county_code"</span>,<span class="st">"county_name"</span>)]<span class="op">$</span>county_name))]</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">county</a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt;       county_code county_name week day is_6pm      S  E  I Ia   R</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt;    1:    county01     Ã˜stfold    1   1   TRUE 292893  0  0  0   0</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt;    2:    county01     Ã˜stfold    1   2   TRUE 292893  0  0  0   0</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt;    3:    county01     Ã˜stfold    1   3   TRUE 292893  0  0  0   0</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt;    4:    county01     Ã˜stfold    1   4   TRUE 292893  0  0  0   0</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt;    5:    county01     Ã˜stfold    1   5   TRUE 292893  0  0  0   0</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt;   ---                                                            </span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">#&gt; 1130:    county50   TrÃ¸ndelag    9  59   TRUE 456477 31 40  0  74</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">#&gt; 1131:    county50   TrÃ¸ndelag    9  60   TRUE 456455 33 46  0  88</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt; 1132:    county50   TrÃ¸ndelag    9  61   TRUE 456429 42 48  0 103</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt; 1133:    county50   TrÃ¸ndelag    9  62   TRUE 456403 43 61  0 115</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">#&gt; 1134:    county50   TrÃ¸ndelag    9  63   TRUE 456367 52 68  0 135</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt;       incidence    pop</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">#&gt;    1:         0 292893</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">#&gt;    2:         0 292893</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="co">#&gt;    3:         0 292893</span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co">#&gt;    4:         0 292893</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">#&gt;    5:         0 292893</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co">#&gt;   ---                 </span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="co">#&gt; 1130:        13 456622</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34"><span class="co">#&gt; 1131:        19 456622</span></a>
<a class="sourceLine" id="cb4-35" data-line-number="35"><span class="co">#&gt; 1132:        16 456622</span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36"><span class="co">#&gt; 1133:        25 456622</span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="co">#&gt; 1134:        27 456622</span></a></code></pre></div>
<p>We can produce a daily epicurve for each county:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(county, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>day, <span class="dt">y=</span>incidence))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_bar">geom_col</a></span>()</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>county_name)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/scale_continuous">scale_x_continuous</a></span>(<span class="st">"Day"</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">p</a></code></pre></div>
<p><img src="commuter_model_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>And we can produce weekly maps:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">w &lt;-<span class="st"> </span>county[,.(</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="dt">incidence_weekly =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(incidence),</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="dt">pop =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(pop)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">), keyby=.(county_code, week)]</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">w[,weekly_incidence_per_<span class="dv">10000</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">10000</span><span class="op">*</span>incidence_weekly<span class="op">/</span>pop]</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">w[,facet<span class="op">:</span><span class="er">=</span>glue<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/glue/topics/glue">glue</a></span>(<span class="st">"Week {week}"</span>,<span class="dt">week=</span>week)]</a>
<a class="sourceLine" id="cb6-8" data-line-number="8"></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">pd &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/merge">merge</a></span>(</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">  w,</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">  fhidata<span class="op">::</span>norway_map_counties, </a>
<a class="sourceLine" id="cb6-12" data-line-number="12">  <span class="dt">by.x=</span><span class="st">"county_code"</span>,</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">  <span class="dt">by.y=</span><span class="st">"location_code"</span>,</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">  <span class="dt">allow.cartesian =</span> T)</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"></a>
<a class="sourceLine" id="cb6-16" data-line-number="16">p &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="dt">data=</span>pd, <span class="dt">mapping=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>( <span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group))</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/geom_polygon">geom_polygon</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">fill=</span>weekly_incidence_per_<span class="dv">10000</span>))</a>
<a class="sourceLine" id="cb6-18" data-line-number="18">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>facet)</a>
<a class="sourceLine" id="cb6-19" data-line-number="19">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_void</a></span>()</a>
<a class="sourceLine" id="cb6-20" data-line-number="20">p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/coord_map">coord_quickmap</a></span>()</a>
<a class="sourceLine" id="cb6-21" data-line-number="21">p</a></code></pre></div>
<p><img src="commuter_model_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#background">Background</a></li>
      <li><a href="#example">Example</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Solveig Engebretsen, Andreas NygÃ¥rd Osnes, Richard White.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
